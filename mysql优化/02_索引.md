# 索引（index）

## 2.1 概述

- 索引是用来帮助mysql高效获取数据的数据结构。

本质上是利用BST来快速检索。BST中指向表中的数据。

## 2.2 索引的优势和劣势

索引的优势：

- 加快速度。降低IO成本
- 降低排序成本，降低CPU消耗

索引的劣势：

- 索引本身占空间。占用磁盘空间
- 更新表的速度会变慢（因为索引要和表保持一致），INSERT, UPDATE, DELETE等操作。

## 2.3 索引的结构

mysql提供的4中索引结构：

- BTREE：重点。（默认的存储引擎是InnoDB，InnoDB默认的索引是BTree）InnoDB, MyISAM, Memory都支持
- HASH：只有Memory引擎支持
- R-tree：只有MyISAM支持
- Full-text：只有MyISAM支持


### BTree（多路平衡搜索树）

- 每个节点最多有m个子节点
- 除了根节点和叶子节点外，每个节点至少有`m / 2`（向上取整）个孩子
- 若根节点不是叶子节点，则至少有两个孩子
- 所有的叶子节点都在同一层
- 每个非叶子节点有n个key和n+1个指针组成，`m / 2`（向上取整）- 1 <= n <= m -  1

> 指针比key多一个，是因为这样刚好错开，小于key刚好就用左边的指针，大于key刚好就用右边的指针

如5叉树，

- m=5
- `m / 2`（向上取整）= 3
- 2 <= n <= 4

当 n > 4时，中间节点分裂为父节点

### B+Tree

- B+树的key最多数量可以比B树多一个，即key和指针的数量一样多。
- B+树的叶子节点保存路径上所有key的信息
- B+树的所有数据都存在叶子节点，叶子节点是串起来的（B树所有节点都会保存数据）

B+树查询任何数据都要走到叶子节点，查找更加稳定。

MySQL中的B+树的叶子节点之间还有双向的链表指针，以便提高区间访问的性能。

## 2.4 索引的分类

- 单列索引：
- 唯一索引：值必须唯一，但是可以为空
- 复合索引：包含多个列

## 2.5 索引的设计原则

- 对查询频次高，数据量大的表建立索引
- 对经常在where中出现的条件字段来创建索引
- 对复合索引，利用左前缀，提高查询效率。

N个列创建符合索引，其实是创建了N个索引。如(name, email, status), 实际上有下面三个索引

- name
- name, email
- name, email, status

